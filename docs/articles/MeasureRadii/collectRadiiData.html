<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collect radial measurements from a calcified structure by interactively selecting annuli • RFishBC</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><meta property="og:title" content="Collect radial measurements from a calcified structure by interactively selecting annuli">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">RFishBC</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/MeasureRadii/collectRadiiData.html">Collect radial measurements from a calcified structure by interactively selecting annuli</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/droglenc/RFishBC">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Collect radial measurements from a calcified structure by interactively selecting annuli</h1>
                        <h4 class="author">Derek H. Ogle</h4>
            
            <h4 class="date">2018-04-14</h4>
      
      <small>Source: <a href="https://github.com/droglenc/RFishBC/blob/master/vignettes/MeasureRadii/collectRadiiData.Rmd"><code>vignettes/MeasureRadii/collectRadiiData.Rmd</code></a></small>
      <div class="hidden name"><code>collectRadiiData.Rmd</code></div>

    </div>

    
    
<p> </p>
<hr>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The size of fish at a previous time in their life is often estimated through “back-calculation.” Back-calculation of previous lengths requires accurate measurements of annual growth on calcified structures from individual fish and a suitable model that relates growth on the structure to growth of the fish.</p>
<p>The <a href="https://fisheries.org/bookstore/all-titles/software/70317/">FishBC software</a> is commonly used to measure lengths on a calcified structure and apply a back-calculation model to estimate length at previous ages. However, FishBC only works on out-dated computers, there are no plans to update it, and it is not open source. The functionality in the <code>RFishBC</code> package is meant to replace the FishBC software. Methods for making measurements on images of calcified structures is demonstrated in this document. Using those measurements to back-calculate fish length at a previous age is demonstrated in <a href="backcalculation.html">a separate vignette</a>.</p>
<p> </p>
<hr>
</div>
<div id="vignette-assumptions" class="section level1">
<h1 class="hasAnchor">
<a href="#vignette-assumptions" class="anchor"></a>Vignette Assumptions</h1>
<div id="understand-back-calculation" class="section level2">
<h2 class="hasAnchor">
<a href="#understand-back-calculation" class="anchor"></a>Understand Back-Calculation</h2>
<p>This vignette assumes that you have a basic understanding of back-calculating fish length at previous ages. See <a href="https://www.researchgate.net/publication/226394736_The_Back-Calculation_of_Fish_Growth_From_Otoliths">Vigliola and Meekan (2009)</a> and Section 11.2.3.1 in Shoup and Michaeletz (2017) for thorough introductions to this topic.</p>
<p>You should be aware of two foundational definitions related to measuring radii on calcified structures. First, <strong>calcified structures</strong> are scales, spines, fin rays, otoliths, or other bones from fish that can be processed in such a way as to show marks that represent annuli, or yearly benchmarks. Hereafter, “structure” will refer to “calcified structure.” Second, <strong>radii</strong> are sequential measurements from the focus (i.e., center) of the structure to the annuli, usually along a linear transect from the focus to the margin (i.e., edge) of the structure. Radii are in contrast to increments, which are the distance between successive annuli along the transect.</p>
</div>
<div id="static-structure-images" class="section level2">
<h2 class="hasAnchor">
<a href="#static-structure-images" class="anchor"></a>Static Structure Images</h2>
<p>This vignette also assumes that you can capture a static digital image of a structure. The image must be a jpeg (.jpg), portable network graphics (.png), or bitmap (.bmp) format. Images will usually be obtained from a camera mounted on a microscope and connected to a computer. Below is a sample image of a fish scale.</p>
<div class="figure">
<img src="Scale_1.jpg">
</div>
<p>Ideally, but not necessarily, the image will also contain an object (e.g., a “scale-bar”) of known length so that actual lengths on the structure can be found. If a scale-bar is absent, then the measured lengths will be on an arbitrary scale (i.e., the actual values will be meaningless but the proportion of the total structure radius to each annulus will be meaningful). Below is a sample image of a Kiyi otolith with a 1-mm scale-bar.</p>
<div class="figure">
<img src="oto140306.jpg">
</div>
<p>The process described herein requires that all images to be processed be stored in the same directory or folder. To be most efficient (and simple), this directory should contain ONLY image files related to a particular project (e.g., one species for one water body for one year) and all image files should be of the same type (e.g., png or jpg).</p>
<p>Generally, the user will “set” the current working directory in R to the directory where these images are stored with <code>setwd()</code>. If using RStudio, the working directory can be set with any of the options under the Session … Set Working Directory menu.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> The following is an example of setting a working directory in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">"c:/work/aging/Kiyi2014"</span>)</code></pre></div>
<p>Finally, note that the process described herein will produce one R data object files (.RData files; hereafter called “RData file”) for each set of measurements made on a structure images. These data files will be saved in the same directory that has the structure image files. I suggest keeping the RData and corresponding structure image files together at all times as the RData file serves as an archive of the data collected from each image.</p>
</div>
<div id="r-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#r-packages" class="anchor"></a>R Packages</h2>
<p>Finally, the methods described in this vignette require the following packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RFishBC)
<span class="kw">library</span>(dplyr)    <span class="co"># for mutate(), inner_join()</span>
<span class="kw">library</span>(tidyr)    <span class="co"># for spread()</span></code></pre></div>
<p> </p>
<hr>
</div>
</div>
<div id="collectdata" class="section level1">
<h1 class="hasAnchor">
<a href="#collectdata" class="anchor"></a>Collect Radii Data from the Structure Image</h1>
<p>The <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> function is used to</p>
<ol style="list-style-type: decimal">
<li>Load an image of a structure.</li>
<li>Optionally provide a scaling for the image.</li>
<li>Interactively select annuli on the structure image.</li>
<li>Create an RData file that contains the radial measurements to selected annuli and other information about the structure and the data extraction process.</li>
</ol>
<p>For example (<em>but described thoroughly further below</em>), the line below identifies “Scale_1.jpg” as the structure image, this fish has an identification number of “1”, this reading of the image should be labelled as “DHO”, and edge should be considered as annulus. When this line is run it will open the image<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>, allow the user to select points that represent annuli, and save radial measurements in “Scale_1_DHO.Rdata”.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/digitizeRadii.html">digitizeRadii</a></span>(<span class="st">"Scale_1.jpg"</span>,<span class="dt">ID=</span><span class="st">"1"</span>,<span class="dt">reading=</span><span class="st">"DHO"</span>,<span class="dt">edgeIsAnnulus=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>Further specifics of <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> and its many arguments are described below.</p>
<div id="the-basics" class="section level2">
<h2 class="hasAnchor">
<a href="#the-basics" class="anchor"></a>The Basics</h2>
<p>The first several arguments to <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> are related to information about the structure.</p>
<ul>
<li>
<code>fname=</code>: File name for the structure image. This is just a file name if the file is in the current working directory, however may be the fully pathed name if the image file is not in the current working directory. If this argument is not given, then a dialog box will be provided from which the file can be selected.</li>
<li>
<code>ID=</code>: <strong>Required</strong> unique identifier for the fish/structure.</li>
<li>
<code>reading=</code>: Optional label for the reading.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>
</li>
<li>
<code>suffix=</code>: Optional additional label for the resultant RData file.</li>
<li>
<code>description=</code>: Optional detailed description about the structure. This will be saved in the RData file and shown in various plots and tables. For example, one may use <code>description="Cisco scale read once by Ogle on 22-Apr-18"</code> to provide more information about the structure reading.</li>
</ul>
<p>The RData file that will be created after the annuli have been selected will have the same name as the image file<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a> but including the suffix optionally provided in <code>suffix=</code>. If nothing is given in <code>suffix=</code>, then a suffix will be created from <code>reading=</code>. For example, if the structure image file was named “Scale_1.jpg”, then the resultant RData file will be named “Scale_1_DHO.Rdata” if <code>reading="DHO"</code> or “Scale_1_TESTING.Rdata” if <code>reading="DHO"</code> and <code>suffix="TESTING"</code>.</p>
<p>Some fish will be captured at a time of year when growth for the current season has not commenced and, thus, the margin of the structure is considered to be an annulus. Other fish may be captured when growth has commence for the season (but not yet completed) such that the structure margin is not considered to be an annulus. If the scale margin is considered an annulus, then use <code>edgeIsAnnulus=TRUE</code>. If the scale margin is not considered an annulus, then use <code>edgeIsAnnulus=FALSE</code>. Identifying whether the structure margin is an annulus or not is critical to properly recording radial measurements. As such, there is no default value for this argument (i.e., it <strong>MUST</strong> be set by the user).</p>
</div>
<div id="setting-the-scale-on-the-image" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-the-scale-on-the-image" class="anchor"></a>Setting the Scale on the Image</h2>
<p>If actual lengths, rather than arbitrary (but proportional) lengths are needed,<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> then a scaling factor must exist to convert measurements on the image to actual measurements on the structure. This scaling factor may be calculated from a scale-bar found on the image or provided by the user.</p>
<p><strong>Scale-bar On Image:</strong> If a scale-bar of known length exists on the image, then use <code>scaleBar=TRUE</code> with the actual length of the scale bar given in <code>scaleBarLength=</code>. You will then need to select the two end points of the scale-bar on the structure image prior to selecting points that represent annuli. An appropriate scaling factor will then be computed from your selections and the radial measurements will be converted to the actual scale (see further below).</p>
<p><strong>Separately Define Scaling Factor:</strong> In applications where a scale-bar does not exist on the image, the user can provide a value to <code>scalingFactor=</code> which will be used to multiply lengths on the structure image to derived actual lengths. One way to derive this scaling factor values is to capture an image of the structure at a specific magnification on the microscope and then capture an image of an object of known length at that same magnification. A scaling factor may then be computed from the image with the object of known length and applied to the structure image. This scaling factor can be found by giving <code>findScalingFactor()</code> the file name with the object of known length and that known length in <code>knownLength=</code>. The value returned from <code>findScalingFactor()</code> can then be given to <code>scalingFactor=</code> in <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code>.<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a></p>
<p>If no <code>scalingFactor=</code> is given or derived from a scale-bar, then the radial measurements returned by <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> are simply proportional to the unknown actual lengths on the structure.</p>
</div>
<div id="selecting-annuli-on-the-image" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-annuli-on-the-image" class="anchor"></a>Selecting Annuli on the Image</h2>
<p>The user will then be asked to select points on the structure image that represent annuli. However, <strong>the point that represents the focus must be selected first, followed by the structure margin/edge</strong>.<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a> If <code>addTransect=TRUE</code> (the default behavior), then a line will be drawn between these two points to aid marking the annuli. When the last point has been selected, the user must press the ESCape key in Windows or with Mac OS X (or, in Windows, select STOP in the menu on the structure image window).</p>
</div>
<div id="setoptions1" class="section level2">
<h2 class="hasAnchor">
<a href="#setoptions1" class="anchor"></a>Other Arguments for <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> &amp; Setting them for a Session</h2>
<p>The <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> function has several optional arguments not discussed above. Some arguments that are likely to be commonly used are:</p>
<ul>
<li>By default, each image file is opened in a separate window, which helps avoid issues with the RStudio Plots pane and is especially useful when working on a system with two monitors.<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a> This window is also configured so that when it is resized, the shape of the structure image (i.e., its aspect ratio) will not change. One can suppress showing the structure image in a separate window with <code>sepWindow=FALSE</code>.</li>
<li>The color and width of the transect shown on the image can be modified with <code>col.transect=</code> and <code>lwd.transect=</code>, respectively.</li>
<li>The plotting character, color, and relative size of the selected points can be modified with <code>pch.sel=</code>, <code>col.sel=</code>, and <code>cex.sel=</code>, respectively.</li>
</ul>
<p>These and other arguments have default settings that are stored in an object that can be accessed with <code><a href="../../reference/RFBCoptions.html">RFBCoptions()</a></code>. Using this function without any arguments will show all of the arguments that can be set and what their default values are (not shown here because the list is long). The current value for one argument can be seen by appending the name of that argument to <code><a href="../../reference/RFBCoptions.html">RFBCoptions()</a></code> separated by a <code>$</code>. For example, the current setting for <code>addTransect</code> is <code>TRUE</code> as shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/RFBCoptions.html">RFBCoptions</a></span>()<span class="op">$</span>addTransect
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>These “default” values for arguments can be changed so that they do not need to be included each time you call <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code>. For example, suppose that you want the “reading” label to say “DHO”, the edge to not be considered an annulus, the width of the transect line to be thicker, and a scale-bar is present with a known length of 0.6 mm. You can set these items in <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> as below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/digitizeRadii.html">digitizeRadii</a></span>(<span class="st">"Scale_1.jpg"</span>,<span class="dt">ID=</span><span class="st">"1"</span>,<span class="dt">reading=</span><span class="st">"DHO"</span>,<span class="dt">edgeIsAnnulus=</span><span class="ot">FALSE</span>,
              <span class="dt">lwd.transect=</span><span class="dv">3</span>,<span class="dt">scaleBar=</span><span class="ot">TRUE</span>,<span class="dt">scaleBarLength=</span><span class="fl">0.6</span>)</code></pre></div>
<p>However, if you want to use these settings for all images in a session then it is a hassle to set them every time you call <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code>. The default values for these arguments can be set for the entire session (i.e., until you change them or close R and open it again) by including the argument name set equal to the desired default value within <code><a href="../../reference/RFBCoptions.html">RFBCoptions()</a></code>. For example, if the code below is run at the beginning of a session (i.e., early in the script), then every call to <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> after that will default to using “DHO” as the reading label, not treating the edge as an annulus, using a thicker line for the transect, and identifying that a scale-bar with a known length of 0.6 exists on the image.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">RFBC</span>(<span class="dt">reading=</span><span class="st">"DHO"</span>,<span class="dt">edgeIsAnnulus=</span><span class="ot">FALSE</span>,<span class="dt">edgeIsAnnulus=</span><span class="ot">FALSE</span>,
     <span class="dt">lwd.transect=</span><span class="dv">3</span>,<span class="dt">scaleBar=</span><span class="ot">TRUE</span>,<span class="dt">scaleBarLength=</span><span class="fl">0.6</span>)</code></pre></div>
<p>With this, the last call to <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> above could be simplified as shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/digitizeRadii.html">digitizeRadii</a></span>(<span class="st">"Scale_1.jpg"</span>,<span class="dt">ID=</span><span class="st">"1"</span>)</code></pre></div>
<p>Argument values can still be changed from these for a particular call to <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> by including that argument in the specific call. For example if the edge was an annulus for only one of the structures then include <code>edgeIsAnnulus=TRUE</code> in <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code>.</p>
<p> </p>
<p> </p>
<hr>
</div>
</div>
<div id="examine-radii-data" class="section level1">
<h1 class="hasAnchor">
<a href="#examine-radii-data" class="anchor"></a>Examine Radii Data</h1>
<div id="data-frame-of-radii-measurements" class="section level2">
<h2 class="hasAnchor">
<a href="#data-frame-of-radii-measurements" class="anchor"></a>Data.frame of Radii Measurements</h2>
<p>The result from <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code> (see <a href="#collectdata">Section 2</a>) is an RData file in the current working directory. Among other things, this data file contains a data.frame of radial measurements to successive annuli that can be extracted with <code><a href="../../reference/combineData.html">combineData()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/combineData.html">combineData</a></span>(<span class="st">"Scale_1_DHO.RData"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df
<span class="co">#&gt;   ID reading ageCap ann       rad    radCap</span>
<span class="co">#&gt; 1  1     DHO      5   1 0.2141602 0.5143776</span>
<span class="co">#&gt; 2  1     DHO      5   2 0.2767637 0.5143776</span>
<span class="co">#&gt; 3  1     DHO      5   3 0.3289998 0.5143776</span>
<span class="co">#&gt; 4  1     DHO      5   4 0.4621417 0.5143776</span>
<span class="co">#&gt; 5  1     DHO      5   5 0.4974369 0.5143776</span>
<span class="co">#&gt; 6  1     DHO      5   6 0.5143776 0.5143776</span></code></pre></div>
<p>The <code><a href="../../reference/combineData.html">combineData()</a></code> function is more interesting when considering multiple structures (see <a href="#multiplestructures">Section 6</a>).</p>
</div>
<div id="visualize-annular-markings" class="section level2">
<h2 class="hasAnchor">
<a href="#visualize-annular-markings" class="anchor"></a>Visualize Annular Markings</h2>
<p>One can review the markings on a structure with <code><a href="../../reference/showDigitizedImage.html">showDigitizedImage()</a></code>, which requires only the name of an RData file.<a href="#fn10" class="footnoteRef" id="fnref10"><sup>10</sup></a> The plotting character, color, and relative size of the selected points may be changed with <code>pch.show=</code>, <code>col.show=</code>, and <code>cex.show=</code>. The color and width of the “transect” may be changed with <code>col.transect=</code> and <code>lwd.transect=</code> or excluded altogether with <code>showTransect=FALSE</code>. Defaults for these arguments can be set with <code><a href="../../reference/RFBCoptions.html">RFBCoptions()</a></code> as was demonstrated in <a href="#setoptions1">Section 3.4</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/showDigitizedImage.html">showDigitizedImage</a></span>(<span class="st">"Scale_1_DHO.RData"</span>)</code></pre></div>
<p><img src="collectRadiiData_files/figure-html/unnamed-chunk-12-1.png" width="449.511811023622"></p>
<p> </p>
<p> </p>
<hr>
</div>
</div>
<div id="examine-multiple-reads-of-the-same-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#examine-multiple-reads-of-the-same-structure" class="anchor"></a>Examine Multiple Reads of the Same Structure</h1>
<p>In some instances, one may be interested in visually comparing the selected points from multiple readings of the same structure. For example, the code below was used to collect a second set of points for the “Scale_1.jpg” image.<a href="#fn11" class="footnoteRef" id="fnref11"><sup>11</sup></a> Note the different value in <code>reading=</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/digitizeRadii.html">digitizeRadii</a></span>(<span class="st">"Scale_1.jpg"</span>,<span class="dt">ID=</span><span class="st">"1"</span>,<span class="dt">reading=</span><span class="st">"DHO2"</span>,<span class="dt">edgeIsAnnulus=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>The <code><a href="../../reference/showDigitizedImage.html">showDigitizedImage()</a></code> function described above can also used to overlay annular points from multiple readings of the same structure. This requires a vector of RData file names from the same structure as the first argument. The <code><a href="../../reference/listFiles.html">listFiles()</a></code> function may be used to identify all filenames in the current working directory that have a the file extension given in the first argument. For example, all files with the “RData” extension are found below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/listFiles.html">listFiles</a></span>(<span class="st">"RData"</span>)
<span class="co">#&gt; [1] "Scale_1_DHO.RData"  "Scale_1_DHO2.RData" "Scale_2_DHO.RData"</span></code></pre></div>
<p>This list of names can be further filtered by including other key words for the filenames in <code>other=</code>. For example, all files with the “RData” extension that contain the keyword “Scale_1” are returned. For our purposes here, these filenames are saved into an object (e.g., <code>fns</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( fns &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/listFiles.html">listFiles</a></span>(<span class="st">"RData"</span>,<span class="dt">other=</span><span class="st">"Scale_1"</span>) )
<span class="co">#&gt; [1] "Scale_1_DHO.RData"  "Scale_1_DHO2.RData"</span></code></pre></div>
<p>The multiple readings of “Scale_1” can be seen by giving this set of filenames to <code><a href="../../reference/showDigitizedImage.html">showDigitizedImage()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/showDigitizedImage.html">showDigitizedImage</a></span>(fns)</code></pre></div>
<p><img src="collectRadiiData_files/figure-html/unnamed-chunk-16-1.png" width="449.511811023622"></p>
<p>Aspects of the transects and points may be controlled with arguments to <code>showDigitezedData()</code>. For example, the code below uses different colors for two transects and points and a thicker line for each transect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/showDigitizedImage.html">showDigitizedImage</a></span>(fns,<span class="dt">col.transect=</span><span class="kw">c</span>(<span class="st">"red"</span>,<span class="st">"yellow"</span>),
                   <span class="dt">col.show=</span><span class="kw">c</span>(<span class="st">"yellow"</span>,<span class="st">"red"</span>),<span class="dt">lwd.transect=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="collectRadiiData_files/figure-html/unnamed-chunk-17-1.png" width="449.511811023622"></p>
<p> </p>
<p> </p>
<hr>
</div>
<div id="multiplestructures" class="section level1">
<h1 class="hasAnchor">
<a href="#multiplestructures" class="anchor"></a>Combine Data from Multiple Structures</h1>
<div id="file-organization" class="section level2">
<h2 class="hasAnchor">
<a href="#file-organization" class="anchor"></a>File Organization</h2>
<p>Of course, most analyses will consist of collecting radial measurements from structures from many fish. In this section, I demonstrate how to combine measurements from multiple structures. This demonstration assumes that all structure image files of interest are in the current working directory.<a href="#fn12" class="footnoteRef" id="fnref12"><sup>12</sup></a></p>
<p>The <code><a href="../../reference/listFiles.html">listFiles()</a></code> function (described in the previous section) is used to identify file names with the “jpg” extension.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/listFiles.html">listFiles</a></span>(<span class="st">"jpg"</span>)
<span class="co">#&gt; [1] "Oto140306.jpg" "Scale_1.jpg"   "Scale_2.jpg"</span></code></pre></div>
<p>In this case, however, this list needs to limited to only those files that contain the keyword “Scale”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( fns &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/listFiles.html">listFiles</a></span>(<span class="st">"jpg"</span>,<span class="dt">other=</span><span class="st">"Scale"</span>) )
<span class="co">#&gt; [1] "Scale_1.jpg" "Scale_2.jpg"</span></code></pre></div>
</div>
<div id="processing-multiple-structure-images" class="section level2">
<h2 class="hasAnchor">
<a href="#processing-multiple-structure-images" class="anchor"></a>Processing Multiple Structure Images</h2>
<p>The user would then process each structure in the working directory as described in <a href="#collectdata">Section 1</a>. This will require multiple calls to <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code>, each with a different structure image file name. If the file names are stored in an object as show above, then these names can be extracted by their position in the object. For example, <code>fns[1]</code> identifies the first filename in <code>fns</code> (i.e., “Scale_1.jpg”). The <code>ID=</code> argument should change to represent the unique identification number of each fish. Finally, <code><a href="../../reference/RFBCoptions.html">RFBCoptions()</a></code> can be used to change default values for some arguments as described in <a href="#setoptions1">Section 3.4</a> and shown below for the <code>reading=</code> and <code>edgeIsAnnlus=</code> arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/RFBCoptions.html">RFBCoptions</a></span>(<span class="dt">reading=</span><span class="st">"DHO"</span>,<span class="dt">edgeIsAnnulus=</span><span class="ot">FALSE</span>)
<span class="kw"><a href="../../reference/digitizeRadii.html">digitizeRadii</a></span>(fns[<span class="dv">1</span>],<span class="dt">ID=</span><span class="st">"1"</span>)
<span class="kw"><a href="../../reference/digitizeRadii.html">digitizeRadii</a></span>(fns[<span class="dv">2</span>],<span class="dt">ID=</span><span class="st">"2"</span>)</code></pre></div>
</div>
<div id="combining-data-extracted-from-multiple-structure-images" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-data-extracted-from-multiple-structure-images" class="anchor"></a>Combining Data Extracted from Multiple Structure Images</h2>
<p>Once all structure image files have been processed, the radial measurements can be combined into one data.frame with <code><a href="../../reference/combineData.html">combineData()</a></code>. The first argument to this function is a vector of RData file names, which can be constructed using <code><a href="../../reference/listFiles.html">listFiles()</a></code> with the <code>.RData</code> extension.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/listFiles.html">listFiles</a></span>(<span class="st">"RData"</span>)
<span class="co">#&gt; [1] "Scale_1_DHO.RData"  "Scale_1_DHO2.RData" "Scale_2_DHO.RData"</span></code></pre></div>
<p>However, I don’t want the “DHO2” file in this case. Thus I restricted the list of files to those that have “DHO.” in the name, but because the “.” is a special character it had to be preceded by “\”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( fns2 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/listFiles.html">listFiles</a></span>(<span class="st">"RData"</span>,<span class="dt">other=</span><span class="st">"DHO</span><span class="ch">\\</span><span class="st">."</span>) )
<span class="co">#&gt; [1] "Scale_1_DHO.RData" "Scale_2_DHO.RData"</span></code></pre></div>
<p>Finally, the data in these two files are combined and stored in <code>dfrad</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( dfrad &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/combineData.html">combineData</a></span>(fns2) )
<span class="co">#&gt;    ID reading ageCap ann       rad    radCap</span>
<span class="co">#&gt; 1   1     DHO      5   1 0.2141602 0.5143776</span>
<span class="co">#&gt; 2   1     DHO      5   2 0.2767637 0.5143776</span>
<span class="co">#&gt; 3   1     DHO      5   3 0.3289998 0.5143776</span>
<span class="co">#&gt; 4   1     DHO      5   4 0.4621417 0.5143776</span>
<span class="co">#&gt; 5   1     DHO      5   5 0.4974369 0.5143776</span>
<span class="co">#&gt; 6   1     DHO      5   6 0.5143776 0.5143776</span>
<span class="co">#&gt; 7   2     DHO      4   1 0.1665271 0.4385261</span>
<span class="co">#&gt; 8   2     DHO      4   2 0.2341519 0.4385261</span>
<span class="co">#&gt; 9   2     DHO      4   3 0.3220884 0.4385261</span>
<span class="co">#&gt; 10  2     DHO      4   4 0.3888447 0.4385261</span>
<span class="co">#&gt; 11  2     DHO      4   5 0.4385261 0.4385261</span></code></pre></div>
</div>
<div id="preparing-for-back-calculations" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-for-back-calculations" class="anchor"></a>Preparing for Back-Calculations</h2>
<p>Other information about the fish (e.g., location of capture, length, sex) is likely held in a separate file. Below, example “other” data are loaded into the <code>dffish</code> data.frame. Note that the <code>ID</code> and <code>reading</code> variables created from processing the structure images above are characters. In this case, <code>read.csv()</code> reads the <code>ID</code> variable from the external data file as numeric (because the unique IDs were simple numbers). The second line of code below converts these numeric IDs to characters so that this data.frame can be joined with the radial measurements data.frame from above.<a href="#fn13" class="footnoteRef" id="fnref13"><sup>13</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dffish &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"FishData.csv"</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ID=</span><span class="kw">as.character</span>(ID)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(dfrad,<span class="dt">by=</span><span class="st">"ID"</span>)
dffish
<span class="co">#&gt;    ID  loc sex len reading ageCap ann       rad    radCap</span>
<span class="co">#&gt; 1   1 MI-5   M 189     DHO      5   1 0.2141602 0.5143776</span>
<span class="co">#&gt; 2   1 MI-5   M 189     DHO      5   2 0.2767637 0.5143776</span>
<span class="co">#&gt; 3   1 MI-5   M 189     DHO      5   3 0.3289998 0.5143776</span>
<span class="co">#&gt; 4   1 MI-5   M 189     DHO      5   4 0.4621417 0.5143776</span>
<span class="co">#&gt; 5   1 MI-5   M 189     DHO      5   5 0.4974369 0.5143776</span>
<span class="co">#&gt; 6   1 MI-5   M 189     DHO      5   6 0.5143776 0.5143776</span>
<span class="co">#&gt; 7   2 MI-6   F 210     DHO      4   1 0.1665271 0.4385261</span>
<span class="co">#&gt; 8   2 MI-6   F 210     DHO      4   2 0.2341519 0.4385261</span>
<span class="co">#&gt; 9   2 MI-6   F 210     DHO      4   3 0.3220884 0.4385261</span>
<span class="co">#&gt; 10  2 MI-6   F 210     DHO      4   4 0.3888447 0.4385261</span>
<span class="co">#&gt; 11  2 MI-6   F 210     DHO      4   5 0.4385261 0.4385261</span></code></pre></div>
<p>Some people prefer that the data be presented in “one-fish-per-line” rather than “one-measurement-per-line” (as in <code>dffish</code>) format. The one-measurement-per-line data.frame can be converted to one-fish-per-line by including it as the first argument to <code>spread()</code>. In addition, the variable name that identifies the annuli number must be included in <code>key=</code> and variable name that identifies the radial measurements must be included in <code>value=</code>. The <code>sep=</code> argument is used here as well so that the column names in the resultant data.frame are not simply numbers. In this case, the new variable names will be a combination of the variable name in <code>key=</code>, the string in <code>sep=</code>, and the numbers in the <code>value=</code> variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dffish2 &lt;-<span class="st"> </span><span class="kw">spread</span>(dffish,<span class="dt">key=</span>ann,<span class="dt">value=</span>rad,<span class="dt">sep=</span><span class="st">"rad"</span>)
dffish2
<span class="co">#&gt;   ID  loc sex len reading ageCap    radCap   annrad1   annrad2   annrad3</span>
<span class="co">#&gt; 1  1 MI-5   M 189     DHO      5 0.5143776 0.2141602 0.2767637 0.3289998</span>
<span class="co">#&gt; 2  2 MI-6   F 210     DHO      4 0.4385261 0.1665271 0.2341519 0.3220884</span>
<span class="co">#&gt;     annrad4   annrad5   annrad6</span>
<span class="co">#&gt; 1 0.4621417 0.4974369 0.5143776</span>
<span class="co">#&gt; 2 0.3888447 0.4385261        NA</span></code></pre></div>
<p>Either file can be written to a “comma-separated values” (CSV) file with <code>write.csv()</code> using the R object name (e.g., <code>dffish</code> or <code>dffish2</code> as the first argument and a name for the file in <code>file=</code>. Additionally, I prefer to have non-quoted values by using <code>quote=FALSE</code> and no row names by using <code>row.names=FALSE</code>. For example, the “one-measurement-per-line” data can be output to “Kiyi2014_BCs.csv” as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(dffish,<span class="dt">file=</span><span class="st">"Kiyi2014_BCs.csv"</span>,<span class="dt">quote=</span><span class="ot">FALSE</span>,<span class="dt">row.names=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>CSV files are small, portable, and can be opened directly in most spreadsheet softwares.</p>
<p> </p>
<p> </p>
<hr>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li><p>Shoup, D.E., and P.H. Michaletz. 2017. Growth estimation: Summarization. Pages 233-264 in Quist, M.C. and D.A. Isermann, editors. Age and growth of fishes: principles and techniques. American Fisheries Society, Bethesda, MD.</p></li>
<li><p>Vigliola, L., and M.G. Meekan. 2009. The back-calculation of fish growth from otoliths. Pages 174-211 in Green, B., B. Mapstone, G. Carlos, and G. Begg, editors. Tropical fish otoliths: information for assessment, management and ecology, volume 11. Springer, Dordrecht, Netherlands.</p></li>
</ul>
<p> </p>
<p> </p>
<hr>
</div>
<div id="footnotes" class="section level1">
<h1 class="hasAnchor">
<a href="#footnotes" class="anchor"></a>Footnotes</h1>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>My preference is to start a script that will contain all of the code described later in this vignette. If this script is saved to the same directory with the structure images then the working directory can be set in RStudio with the Session … Set Working Directory … to Source File Location menu items. I then copy the resultant <code>setwd()</code> code to my script so that I do not have to use the menu items when I run this script again.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>This assumes that the <code>Scale_1.jpg</code> file is in the current working directory. You can see what the current working directory is with <code>getwd()</code>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Actually much more than the radial measurements are recorded in the RData file (discussed further below). Also note that the radii are on an arbitrary scale in this case because no scale-bar was available on the image.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>The <code>readings</code> item is primarily used when the structure is read more than once. However, it is a required component in this package, whether multiple reads of the same structure are planned or not.<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>The extension (e.g., “png” or “jpg”) will not be included in the resultant R data object file.<a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>Some back-calculation methods require knowing the relationship between actual scale length and fish length. See <a href="backcalculation.html">this vignette</a> for more details.<a href="#fnref6">↩</a></p></li>
<li id="fn7"><p>Thus, <code>findScalingFactor()</code> would be run prior to <code><a href="../../reference/digitizeRadii.html">digitizeRadii()</a></code>.<a href="#fnref7">↩</a></p></li>
<li id="fn8"><p>When the structure image is in the “Plots” pane of RStudio, the points will not be visible until after you have finished selecting all points.<a href="#fnref8">↩</a></p></li>
<li id="fn9"><p>For example, you could have R/RStudio on one monitor and the window with the structure image on the other.<a href="#fnref9">↩</a></p></li>
<li id="fn10"><p>If no file name is given, then a dialog box will appear from which the data file can be selected.<a href="#fnref10">↩</a></p></li>
<li id="fn11"><p>The first set of readings were made in the first section above.<a href="#fnref11">↩</a></p></li>
<li id="fn12"><p>This process will be more efficient if not other image files of the same sort (e.g., “.jpg”) are in this directory. The working directory may be seen with <code>getwd()</code> and set with <code>setwd()</code> or any of the items under the “Session” menu and “Set Working Directory” submenu items in RStudio.<a href="#fnref12">↩</a></p></li>
<li id="fn13"><p>The two files cannot be joined by the “ID” variable if the “ID” variables are of different types (e.g., character and numeric) in the two files. Thus, as shown here, they must be coerced to be the same type. This line of code would no be needed if the “ID” variables were of the same type in the two files as would likely occur if the “ID” variable was not simply numbers.<a href="#fnref13">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#vignette-assumptions">Vignette Assumptions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#understand-back-calculation">Understand Back-Calculation</a></li>
      <li><a href="#static-structure-images">Static Structure Images</a></li>
      <li><a href="#r-packages">R Packages</a></li>
      </ul>
</li>
      <li>
<a href="#collectdata">Collect Radii Data from the Structure Image</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-basics">The Basics</a></li>
      <li><a href="#setting-the-scale-on-the-image">Setting the Scale on the Image</a></li>
      <li><a href="#selecting-annuli-on-the-image">Selecting Annuli on the Image</a></li>
      <li><a href="#setoptions1">Other Arguments for <code><a href="--/--/reference/digitizeRadii-html">digitizeRadii()</a></code> &amp; Setting them for a Session</a></li>
      </ul>
</li>
      <li>
<a href="#examine-radii-data">Examine Radii Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data-frame-of-radii-measurements">Data.frame of Radii Measurements</a></li>
      <li><a href="#visualize-annular-markings">Visualize Annular Markings</a></li>
      </ul>
</li>
      <li><a href="#examine-multiple-reads-of-the-same-structure">Examine Multiple Reads of the Same Structure</a></li>
      <li>
<a href="#multiplestructures">Combine Data from Multiple Structures</a><ul class="nav nav-pills nav-stacked">
<li><a href="#file-organization">File Organization</a></li>
      <li><a href="#processing-multiple-structure-images">Processing Multiple Structure Images</a></li>
      <li><a href="#combining-data-extracted-from-multiple-structure-images">Combining Data Extracted from Multiple Structure Images</a></li>
      <li><a href="#preparing-for-back-calculations">Preparing for Back-Calculations</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      <li><a href="#footnotes">Footnotes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Derek Ogle.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
